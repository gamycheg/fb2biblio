# fb2biblio
<h2>Библиотека для fb2 книг(в разработке)</h2> 

<hr>
<h3>Нужно для работы:</h3>
<ul>
  <li>PHP 7+(делал на 7.4)</li>
  <li>MySQL (на сервере 9.1.0)</li>
</ul>
<hr>
<h3>Установка:</h3>
<ul>
  <li>Проверить что сервер соответствует требованиям выше</li> 
  <li>Распаковать архив на сервер</li>
  <li>Установить зависимости через composer install</li>
  <li>Создать БД и таблицы(файл createdb.sql)</li>
  <li>В файле funct.php(1 в папке opds, второй в папке scaner) прописать пароль к БД</li>
  <li>В файле scanner/scan.php прописать путь к директории с книгами(по умолчанию папка "books" в корне сайта</li>
  <li>Запустить scanner/scan.php(Желательно из консоли под админом)</li>
  <li>Дождаться окончания сканирования(10 тысяч книг примерно за 10-15 минут сканируется)</li>
</ul>
<hr>
<h3>Использование:</h3>
<p>каталог OPDS доступен по адресу vash.site/opds/opds.php</p>

<hr>
<h3>План работ</h3>
<ul>
  <li>(сделано)Сделать сканер</li>
  <li>(в процессе)Написать хоть какойто фронт</li>
  <li>(почти сделано)Написать скрипт для работы OPDS(читать changelog)</li>
</ul>


<hr>
<h3>Changelog:</h3>
<b><u>12.05.2025</u></b><br>
<b>OPDS каталог:</b><br>
Немного переделал запросы в БД, теперь работает достаточно быстро<br>
Доработал отображение обложек.Остался поиск по каталогу.<br><br>
<b>По сканеру:</b><br>
Полностью переделал сканер, теперь весь файл читается одной функцией из 10 тысяч книг в "плохие" попадает менее 1%.
Сканер допиливать больше не буду.
<br><b><u>07.05.2025</u></b><br>
OPDS каталог:<br>
Сделал базу каталога, <br>
каталог доступен по адресу vash.site/opds/opds.php<br>
осталось допилить чтобы обложки отображались во всех разделах, и присобачить поиск по книгам.<br>
<br><b><u>05.05.2025</u></b><br>
По сканеру:<br>
Остановил доработку сканера, т.к. отлавливать все ошибки пока не готов(человеческий фактор просчитать полностью не возможно), возможно когда сделаю opds и веб интерфейс, вернусь к нему и перепишу полностью без библиотеки товарища <a href="https://github.com/iooe">iooe</a>, так как его сканер сделан по документации формата fb2 а люди просто забили на неё при конвертации, я конечно немного "допилил напильником", но процентов 10 книг всеравно пропускаются из-за ошибок.<br>
<br><b><u>30.04.2025</u></b><br>
Допилил сканер.Отлавливаю исключения.<br>
<i></i>Спасибо <a href="https://github.com/iooe">iooe</a>
за <a href="https://github.com/iooe/FB2-Parser">FB2-Parser</a> 
с ним реализация сканера стала намного проще!</i>
Сканер пробегает указанную директорию, смотрит все папки и zip архивы(rar поидее тоже но не проверял), находит все fb2 файлы.
Каждый fb2 файл проверяется на валидность, невалидные добавляются в таблицу badbooks, валидные разбираются и добавляются в books,authors и прочие.
Повторно книги не добавляются в базу(проверка на существование по названию файла+названия из валидного titla внутри книги.
Все сообщения сканера пишутся в scanner.log (для уменьшения вывода)<br>
